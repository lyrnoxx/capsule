
<!DOCTYPE html>
<!-- This site was created in Webflow. https://webflow.com -->
  <html lang="en">
    <head><meta charset="utf-8"/><title>MTP</title><meta content="width=device-width, initial-scale=1" name="viewport"/>
        <meta content="Webflow" name="generator"/>
        <link href="https://assets.website-files.com/64d38ae33e5403d0f8ae2294/css/gsap-flip-corners.webflow.23a76de7c.css" rel="stylesheet" type="text/css"/>
        <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
        <link href="https://cdn.prod.website-files.com/img/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
        <link href="https://cdn.prod.website-files.com/img/webclip.png" rel="apple-touch-icon"/>
    </head>

<body>

    <div class="page-wrapper">
        <div class="global w-embed">
        <style>

	:root{
  	--beige: #ECEAE5;
    --black: #0E0E0E;
  }
  
  ::selection{
  	background: var(--black);
    color: var(--beige);
  }
  
  .section.is--black ::selection{
  	background: var(--beige);
    color: var(--black);
  }
  
  .section.is--black .eyebrow{
  	border-color: rgba(236,234,229,0.5);
  }

	a{
  	text-decoration: none;
    color: inherit;
  }
  
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
 		font-size: 1.1111111111111112vw;
  }

  /* Max Font Size */
  @media screen and (min-width:1920px) {
   body {font-size: 1.3333333333333333rem;}
  }
  
  .swiper-slide.is-gallery .gallery-img__wrapper{
  	opacity: 0.25;
    transform: scale(0.6);
  }
  
  .swiper-slide.is-gallery .gallery-info__wrapper{
  	opacity: 0;
    transform: translateY(50%);
  }  
  
  .swiper-slide.is-gallery.swiper-slide-active .gallery-img__wrapper{
  	opacity: 1;
    transform: scale(1);  
  }
  .swiper-slide.is-gallery.swiper-slide-active .gallery-info__wrapper{
  	opacity: 1;
    transform: translateY(0%);
  }
    
  
  

        </style>
        </div>

        <nav class="main-wrapper w-inline-block"  style="position:fixed; top:0; left:0; z-index:1000;">
            <div class="nav-w">
                <a href="/" class="nav-link is--active w-inline-"><div class="flex-h"><div class="eyebrow">Home</div></div></a>
            </div>
        </nav>

        <div class="main-wrapper">
            <div class="section">
                <div class="nav-w">
                    <div class="w-full max-w-4xl mt-10">
                    <h1 class="text-4xl font-extrabold text-gray-900 mb-2 text-center items-center eyebrow">Geospatial Stitcher</h1>
                    <p class="text-lg text-gray-600 mb-8 text-center eyebrow">Upload data and parameters to generate a stitched map.</p>

                    <!-- Main Application Card -->
                    <div id="app-container" class="card bg-white p-6 sm:p-10 rounded-xl">
                        
                        <form id="stitchingForm" class="space-y-6">
                            
                            <!-- File Inputs Section -->
                            <div class="grid md:grid-cols-3 gap-6">
                                
                                <!-- 1. Image Folder Input -->
                                <div class="p-4 border-2 border-dashed border-indigo-200 rounded-lg bg-indigo-50 w-inline-block eyebrow">
                                    <label for="imageFolder" class="block text-sm font-medium text-gray-700 mb-2">1. Select Image Folder (MANDATORY)</label>
                                    <input
                                        type="file"
                                        id="imageFolder"
                                        name="imageFolder"
                                        webkitdirectory
                                        directory
                                        required
                                        class="w-full text-sm text-gray-500 file:mr-4 file:py-1 file:px-3"
                                        aria-label="Select the folder containing source images"
                                    />
                                    <p class="text-xs text-indigo-500 mt-1 ">Upload a folder</p>
                                </div>

                                <div class="nav-corners"><div class="nav-corner is--tl"></div><div class="nav-corner is--tr"></div>
                                <div class="nav-corner is--bl"></div><div class="nav-corner is--br"></div></div>    

                                <!-- 2. Trajectory TXT File Input -->
                                <div class="p-4 border-2 border-dashed border-indigo-200 rounded-lg bg-indigo-50 w-inline-block eyebrow">
                                    <label for="trajectoryFile" class="block text-sm font-medium text-gray-700 mb-2 ">2. Upload Trajectory (.txt) File (MANDATORY)</label>
                                    <input
                                        type="file"
                                        id="trajectoryFile"
                                        name="trajectoryFile"
                                        accept=".txt"
                                        required
                                        class="w-full text-sm text-gray-500 file:mr-4 file:py-1 file:px-3"
                                        aria-label="Upload the trajectory text file"
                                    />
                                    <p class="text-xs text-indigo-500 mt-1 ">Only accepts .txt files for trajectory data.</p>
                                </div>

                                <div class="nav-corners"><div class="nav-corner is--tl"></div><div class="nav-corner is--tr"></div>
                                <div class="nav-corner is--bl"></div><div class="nav-corner is--br"></div></div>    

                                <!-- 3. config CFG File Input -->
                                <div class="p-4 border-2 border-dashed border-indigo-200 rounded-lg bg-indigo-50 w-inline-block eyebrow">
                                    <label for="configFile" class="block text-sm font-medium text-gray-700 mb-2">3. Upload Config (.cfg) File (MANDATORY)</label>
                                    <input
                                        type="file"
                                        id="configFile"
                                        name="configFile"
                                        accept=".cfg"
                                        required
                                        class="w-full text-sm text-gray-500 file:mr-4 file:py-1 file:px-3"
                                        aria-label="Upload the configuration file"
                                    />
                                    <p class="text-xs text-indigo-500 mt-1">Only accepts .cfg files for config data.</p>
                                </div>

                                <div class="nav-corners"><div class="nav-corner is--tl"></div><div class="nav-corner is--tr"></div>
                                <div class="nav-corner is--bl"></div><div class="nav-corner is--br"></div></div>    

                            </div>


                            <!-- Submit Button -->
                            <div class="pt-6">
                                <button
                                    type="submit"
                                    id="submitButton"
                                    class="w-full flex items-center justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out disabled:bg-gray-400 eyebrow"
                                >
                                    Stitch Map
                                </button>
                            </div>
                        </form>

                        <!-- Status and Result Display Area -->
                        <div id="statusArea" class="mt-8">
                            <!-- Status Messages (e.g., Processing, Error) -->
                            <div id="messageBox" class="p-4 rounded-lg hidden" role="alert"></div>

                            <!-- Output Image Container -->
                            <div id="outputContainer" class="hidden mt-6 text-center">
                                <h3 class="text-xl font-semibold text-gray-800 mb-4 eyebrow">Stitched Map Output</h3>
                                <img id="stitchedMap" class="w-full h-auto max-h-[60vh] object-contain rounded-lg border-4 border-indigo-400 mx-auto eyebrow" alt="Stitched Map Result" />
                                
                                <button id="resetButton" class="mt-4 py-2 px-6 bg-red-500 hover:bg-red-600 text-white font-medium rounded-lg shadow-md transition duration-150 eyebrow">
                                    Start New Stitch
                                </button>
                            </div>
                        </div>
                        
                    </div>
                    </div>
                    <script type="text/javascript">
                        // Global references
                        const form = document.getElementById('stitchingForm');
                        const submitButton = document.getElementById('submitButton');
                        const messageBox = document.getElementById('messageBox');
                        const outputContainer = document.getElementById('outputContainer');
                        const stitchedMap = document.getElementById('stitchedMap');
                        const resetButton = document.getElementById('resetButton');
                        const API_ENDPOINT = '/drone/stitch';

                        // Function to update the message box with current status
                        function updateStatus(message, type = 'info') {
                            messageBox.textContent = message;
                            messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-800', 'bg-green-100', 'text-green-800', 'bg-blue-100', 'text-blue-800');
                            
                            let classes = '';
                            if (type === 'error') {
                                classes = 'bg-red-100 text-red-800';
                            } else if (type === 'success') {
                                classes = 'bg-green-100 text-green-800';
                            } else {
                                // Default to info/processing
                                classes = 'bg-blue-100 text-blue-800';
                            }
                            messageBox.className = 'p-4 rounded-lg ' + classes;
                        }

                        // Function to show the loading state with a spinner
                        function showProcessing(message = "Processing...") {
                            submitButton.disabled = true;
                            submitButton.innerHTML = `
                                <svg class="spinner animate-spin -ml-1 mr-3 h-5 w-5 border-t-2 border-r-2 border-white rounded-full" viewBox="0 0 24 24"></svg>
                                ${message}
                            `;
                            updateStatus('Starting map stitching process...', 'info');
                            outputContainer.classList.add('hidden');
                        }

                        // Function to hide loading and reset button state
                        function hideProcessing() {
                            submitButton.disabled = false;
                            submitButton.textContent = 'Stitch Map';
                        }

                        // Function to reset the UI after processing
                        function resetApp() {
                            form.reset();
                            outputContainer.classList.add('hidden');
                            messageBox.classList.add('hidden');
                            hideProcessing();
                        }

                        // Exponential backoff fetch utility
                        async function fetchWithRetry(url, options, maxRetries = 3) {
                            for (let i = 0; i < maxRetries; i++) {
                                try {
                                    const response = await fetch(url, options);
                                    if (response.status === 429 && i < maxRetries - 1) { // 429 Too Many Requests
                                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                                        await new Promise(resolve => setTimeout(resolve, delay));
                                        continue;
                                    }
                                    if (!response.ok) {
                                        throw new Error(`Server responded with status: ${response.status} (${response.statusText})`);
                                    }
                                    return response;
                                } catch (error) {
                                    if (i === maxRetries - 1) {
                                        throw error;
                                    }
                                    const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                                    await new Promise(resolve => setTimeout(resolve, delay));
                                }
                            }
                        }


                        // Main form submission handler
                        form.addEventListener('submit', async (e) => {
                            e.preventDefault();

                            // Clear any previous status/output
                            messageBox.classList.add('hidden');
                            outputContainer.classList.add('hidden');

                            const imageFolderInput = document.getElementById('imageFolder');
                            const trajectoryFileInput = document.getElementById('trajectoryFile');
                            const configFileInput = document.getElementById('configFile');

                            if (imageFolderInput.files.length === 0 || trajectoryFileInput.files.length === 0 || configFileInput.files.length === 0) {
                                updateStatus('Please select image folder, a trajectory file and a config file.', 'error');
                                return;
                            }

                            // Start the loading state
                            showProcessing("Uploading and Processing (This may take several minutes)...");

                            const formData = new FormData();
                            
                            // Append folder files. Flask needs to handle these files with their relative paths.
                            for (const file of imageFolderInput.files) {
                                // The name 'images' must match the key Flask expects.
                                formData.append('images', file, file.webkitRelativePath);
                            }
                            // Append trajectory file
                            formData.append('trajectory', trajectoryFileInput.files[0], trajectoryFileInput.files[0].name);
                            formData.append('config', configFileInput.files[0], configFileInput.files[0].name);
                            
                            try {
                                // Use fetch with retry for robust API communication
                                const response = await fetchWithRetry(API_ENDPOINT, {
                                    method: 'POST',
                                    body: formData,
                                    // Note: 'Content-Type': 'multipart/form-data' is NOT set here. 
                                    // The browser handles it automatically when passing a FormData object.
                                });
                                
                                const result = await response.json();
                                
                                if (result.success) {
                                    // Assuming Flask returns a URL to the stitched image
                                    handleSuccess(result.imageUrl);
                                } else {
                                    handleError(result.error || 'Unknown server error during processing.');
                                }
                                
                            } catch (error) {
                                // Handle network errors or errors thrown from fetchWithRetry/response check
                                handleError(error.message);
                            }
                        });


                        function handleSuccess(imageUrl) {
                            hideProcessing();
                            updateStatus('Map stitching complete! Input files have been deleted from the server.', 'success');
                            
                            // Set the output image source
                            stitchedMap.src = imageUrl;
                            stitchedMap.alt = 'Successfully stitched map.';
                            
                            outputContainer.classList.remove('hidden');
                            
                            // Scroll to the output section
                            outputContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }

                        function handleError(errorMessage) {
                            hideProcessing();
                            updateStatus(`Error: Map stitching failed. ${errorMessage}`, 'error');
                        }

                        // Event listener for the reset button
                        resetButton.addEventListener('click', resetApp);

                    </script>
                </div>
            </div>
        </div>

        <!-- <div class="main-wrapper">
            <div class="section">
                <div class="nav-w">

                    <a href="#" class="nav-link is--active w-inline-block">
                        <div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">Visual Slam</div>
                        </div>
                        <div class="flex-h"><div class="dot"></div><div class="eyebrow">stella_vslam</div></div>
                        <div class="flex-h"><div class="dot"></div><div class="eyebrow">Generates poses from images</div></div>
                        <div class="nav-corners"><div class="nav-corner is--tl"></div><div class="nav-corner is--tr"></div>
                        <div class="nav-corner is--bl"></div><div class="nav-corner is--br"></div></div>
                    </a>

                    <a href="/drone/stitch" class="nav-link w-inline-block">
                        <div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">Stitch</div>
                        </div>
                        <div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">Map2dFusion</div>
                        </div><div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">Generates a map from poses and images</div>
                        </div>
                    </a>

                    <a href="/drone/system" class="nav-link w-inline-block" target="_blank">
                        <div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">Potential System</div>
                        </div>
                        <div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">Simulated</div>
                        </div><div class="flex-h">
                            <div class="dot"></div>
                            <div class="eyebrow">End goal website</div>
                        </div>
                    </a>

                    <a href="#" class="nav-link w-inline-block">
                        <div class="flex-h"><div class="dot"></div><div class="eyebrow">second color</div></div><div class="flex-h">
                            <div class="dot"></div><div class="eyebrow">#777777</div></div><div class="flex-h"><div class="dot"></div>
                            <div class="eyebrow">R:119 G:119 B:119</div></div></a>
                                    
                    <a href="#" class="nav-link w-inline-block">
                        <div class="flex-h"><div class="dot"></div><div class="eyebrow">third color</div></div><div class="flex-h">
                            <div class="dot"></div><div class="eyebrow">#333333</div></div><div class="flex-h"><div class="dot"></div>
                            <div class="eyebrow">R:51 G:51 B:51</div></div></a>

                    <a href="#" class="nav-link w-inline-block">
                        <div class="flex-h"><div class="dot"></div><div class="eyebrow">typefaces</div></div><div class="flex-h">
                            <div class="dot"></div><div class="eyebrow">editorial new</div></div><div class="flex-h">
                                <div class="dot"></div>
                                <div class="eyebrow">neue montreal</div>
                            </div>
                        </a>
                    <a href="#" class="nav-link w-inline-block"><div class="flex-h"><div class="dot"></div>
                        <div class="eyebrow">columns</div></div><div class="flex-h"><div class="dot"></div>
                        <div class="eyebrow">width: 122px</div></div><div class="flex-h"><div class="dot"></div>
                        <div class="eyebrow">space: 30px</div>
                        </div>
                    </a>
                </div>
            </div>
        </div> -->
    </div>
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=64d38ae33e5403d0f8ae2294" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://assets.website-files.com/64d38ae33e5403d0f8ae2294/js/webflow.8a8164925.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Flip.min.js"></script>
    <script>

    // ———— Store variables
    const navLinks = document.querySelectorAll(".nav-link");
    const navCorners = document.querySelector(".nav-corners");

    navLinks.forEach(function (link) {

        // ———— Give active link a combo class after removing it from other links
    link.addEventListener("click", function () {
        navLinks.forEach(function (link) {
        link.classList.remove("is--active");
        });
        this.classList.add("is--active");
    });

        // ———— Move corners into link we're hovering
    link.addEventListener("mouseenter", function () {
        const state = Flip.getState(navCorners);
        this.appendChild(navCorners);
        Flip.from(state, {
        duration: 0.4,
        ease: "power1.inOut"
        });
    });

        // ———— Move corners back to active link on hover out
    link.addEventListener("mouseleave", function () {
        const state = Flip.getState(navCorners);
        const activeLink = document.querySelector(".nav-link.is--active");
        activeLink.appendChild(navCorners);
        Flip.from(state, {
        duration: 0.4,
        ease: "power1.inOut"
        });
    });
    });

    </script>
</body>
</html>